import{K as pe,al as ge,k as be,am as we,aa as Te,M as x,g as y,x as h,bb as Re}from"./Dj_qSXc_.js";import{h as Z,j as H}from"./Cie8SrI_.js";import{D as Ee,l as d}from"./CyAkH-4i.js";import{o as g,a as O,s as w,p as Se,n as ke}from"./DGs5A2D8.js";function W(e,t){return e===t||e?.[Te]===t}function Nt(e={},t,r,s){return pe(()=>{var n,a;return ge(()=>{n=a,a=[],be(()=>{e!==r(...a)&&(t(e,...a),n&&W(r(...n),e)&&t(null,...n))})}),()=>{we(()=>{a&&W(r(...a),e)&&t(null,...a)})}}),e}const De="modulepreload",Ae=function(e){return"/kyoaikai-dashboard-app/"+e},V={},Mt=function(t,r,s){let n=Promise.resolve();if(r&&r.length>0){let u=function(c){return Promise.all(c.map(f=>Promise.resolve(f).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),i=o?.nonce||o?.getAttribute("nonce");n=u(r.map(c=>{if(c=Ae(c),c in V)return;V[c]=!0;const f=c.endsWith(".css"),p=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${p}`))return;const m=document.createElement("link");if(m.rel=f?"stylesheet":De,f||(m.as="script"),m.crossOrigin="",m.href=c,i&&m.setAttribute("nonce",i),document.head.appendChild(m),f)return new Promise((k,D)=>{m.addEventListener("load",k),m.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${c}`)))})}))}function a(o){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=o,window.dispatchEvent(i),!i.defaultPrevented)throw o}return n.then(o=>{for(const i of o||[])i.status==="rejected"&&a(i.reason);return t().catch(a)})},j=Ee;function xe(e,t=j){return t<=0||!Number.isFinite(t)?!1:e>0&&Date.now()-e<t}function Y(e){return e.type==="external"}function G(e){return e.type==="internal"}function Pe(e){return e.type==="dummy"}function Ne(e){return t=>{const r=t.data.items;return d.info(`${e}データ: ${r.length}件`),r}}class v extends Error{constructor(t,r){super(t),this.cause=r,this.name="JsonParseError"}}function T(e,t,r,s){return{category:e,message:t,details:r,endpoint:s,timestamp:Date.now()}}function Me(e){return typeof e=="object"&&e!==null&&"category"in e&&"message"in e&&"timestamp"in e}function ee(e){return e===404?"not_found":e===408||e===504?"timeout":e>=500?"server":e>=400?"validation":"unknown"}function q(e,t,r){if(Me(e))return e;if(e instanceof Error&&e.name==="HTTPError"&&"response"in e&&typeof e.response?.status=="number"){const s=ee(e.response.status);return T(s,t,e.message,r)}return e instanceof Error&&e.name==="TimeoutError"?T("timeout",t,e.message,r):e instanceof v?T("validation",t,e.message,r):e instanceof TypeError&&e.message.includes("fetch")?T("network",t,e.message,r):e instanceof Error&&e.message.includes("Empty response")?T("server",t,e.message,r):e instanceof Error?T("unknown",t,e.message,r):T("unknown",t,String(e),r)}class te{key;displayName;type;isDummy;polling;pollingInterval;#a=x(null);#t=x(!1);#s=x(null);#r=x(0);#e=x(!1);#n=null;#o;#i;constructor(t){this.key=t.key,this.displayName=t.displayName,this.type=t.type,this.isDummy=t.isDummy,this.polling=t.polling,this.#i=t.ttlMs??j,this.pollingInterval=t.pollingInterval??this.#i,this.#o=t.fetchFn}getData(){return y(this.#a)}isLoading(){return y(this.#t)}getError(){return y(this.#s)}getTimestamp(){return y(this.#r)}async fetch(t=!1){if(!t&&this.isCacheValid)return d.debug(`[${this.key}] キャッシュ有効、スキップ`),y(this.#a);this.#u();const r=new AbortController;this.#n=r,h(this.#t,!0),h(this.#s,null);try{d.debug(`[${this.key}] 取得開始`);const s=await this.#o(r.signal);return r.signal.aborted?(h(this.#t,!1),null):(h(this.#a,s,!0),h(this.#r,Date.now(),!0),h(this.#t,!1),h(this.#s,null),d.info(`[${this.key}] 取得成功`),s)}catch(s){if(r.signal.aborted)return h(this.#t,!1),null;const n=q(s,`${this.displayName}データの取得に失敗しました`);return h(this.#t,!1),h(this.#s,n,!0),d.error(`[${this.key}] 取得エラー:`,s),null}}clear(){h(this.#a,null),h(this.#r,0),h(this.#s,null),h(this.#t,!1),d.debug(`[${this.key}] クリア`)}abort(){this.#u(),y(this.#t)&&h(this.#t,!1)}activate(){h(this.#e,!0),!this.isCacheValid&&!y(this.#t)&&this.fetch()}deactivate(){h(this.#e,!1),this.#u(),y(this.#t)&&h(this.#t,!1)}get isActive(){return y(this.#e)}get isCacheValid(){return y(this.#a)!==null&&xe(y(this.#r),this.#i)}get hasStaleData(){return y(this.#a)!==null&&y(this.#s)!==null}#u(){this.#n&&(this.#n.abort(),this.#n=null)}}function _e(e){const{key:t,schema:r,transform:s,errorMessage:n,logger:a,createAppError:o,endpoint:i}=e;return u=>{const c=r.safeParse(u);if(!c.success)throw a.error(`[${t}] データ検証エラー:`,c.error),o("validation",n,c.error.message,i);return s(c.data)}}function re(e){const{config:t,dependencies:r,fetcher:s}=e,n=_e({key:t.key,schema:t.schema,transform:t.transform,errorMessage:t.errorMessage,logger:r.logger,createAppError:r.createAppError,endpoint:t.endpoint}),a=s(n);return new te({key:t.key,displayName:t.displayName,type:t.type,isDummy:!1,polling:t.polling??!1,ttlMs:t.cache?.ttlMs??j,pollingInterval:t.pollingInterval,fetchFn:o=>a(o)})}function ve(e,t){return re({config:e,dependencies:t,fetcher:r=>async s=>{const n=await t.externalFetcher(e.endpoint,s);return r(n)}})}function qe(e,t){return re({config:e,dependencies:t,fetcher:r=>async s=>{const n=await t.internalFetcher(e.endpoint,{signal:s});if(!n.ok){const o=ee(n.status);throw t.createAppError(o,e.errorMessage,`HTTP ${n.status}: ${n.statusText}`,e.endpoint)}const a=await n.json();return r(a)}})}function Ie(e,t){const{logger:r}=t,s=e.devOnly!==!1;return new te({key:e.key,displayName:e.displayName,type:"dummy",isDummy:!0,polling:e.polling??!1,ttlMs:e.cache?.ttlMs??j,pollingInterval:e.pollingInterval,fetchFn:async()=>{if(s&&!Re)return r.warn(`[${e.key}] Dummy data source is disabled in production`),null;r.debug(`[${e.key}] Generating dummy data...`);const n=await Promise.resolve(e.generate());return r.info(`${e.displayName}ダミーデータ生成完了`),n}})}class L extends Error{response;request;options;constructor(t,r,s){const n=t.status||t.status===0?t.status:"",a=t.statusText??"",o=`${n} ${a}`.trim(),i=o?`status code ${o}`:"an unknown error";super(`Request failed with ${i}: ${r.method} ${r.url}`),this.name="HTTPError",this.response=t,this.request=r,this.options=s}}class se extends Error{name="NonError";value;constructor(t){let r="Non-error value was thrown";try{typeof t=="string"?r=t:t&&typeof t=="object"&&"message"in t&&typeof t.message=="string"&&(r=t.message)}catch{}super(r),this.value=t}}class C extends Error{name="ForceRetryError";customDelay;code;customRequest;constructor(t){const r=t?.cause?t.cause instanceof Error?t.cause:new se(t.cause):void 0;super(t?.code?`Forced retry: ${t.code}`:"Forced retry",r?{cause:r}:void 0),this.customDelay=t?.delay,this.code=t?.code,this.customRequest=t?.request}}const K=(()=>{let e=!1,t=!1;const r=typeof globalThis.ReadableStream=="function",s=typeof globalThis.Request=="function";if(r&&s)try{t=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type")}catch(n){if(n instanceof Error&&n.message==="unsupported BodyInit type")return!1;throw n}return e&&!t})(),Oe=typeof globalThis.AbortController=="function",ne=typeof globalThis.AbortSignal=="function"&&typeof globalThis.AbortSignal.any=="function",je=typeof globalThis.ReadableStream=="function",Ce=typeof globalThis.FormData=="function",oe=["get","post","put","patch","head","delete"],Ue={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*",bytes:"*/*"},U=2147483647,Le=new TextEncoder().encode("------WebKitFormBoundaryaxpyiPgbbPti10Rw").length,ae=Symbol("stop");class ie{options;constructor(t){this.options=t}}const Fe=e=>new ie(e),$e={json:!0,parseJson:!0,stringifyJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,onUploadProgress:!0,fetch:!0,context:!0},He={next:!0},ze={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,duplex:!0},Be=e=>{if(!e)return 0;if(e instanceof FormData){let t=0;for(const[r,s]of e)t+=Le,t+=new TextEncoder().encode(`Content-Disposition: form-data; name="${r}"`).length,t+=typeof s=="string"?new TextEncoder().encode(s).length:s.size;return t}if(e instanceof Blob)return e.size;if(e instanceof ArrayBuffer)return e.byteLength;if(typeof e=="string")return new TextEncoder().encode(e).length;if(e instanceof URLSearchParams)return new TextEncoder().encode(e.toString()).length;if("byteLength"in e)return e.byteLength;if(typeof e=="object"&&e!==null)try{const t=JSON.stringify(e);return new TextEncoder().encode(t).length}catch{return 0}return 0},ue=(e,t,r)=>{let s,n=0;return e.pipeThrough(new TransformStream({transform(a,o){if(o.enqueue(a),s){n+=s.byteLength;let i=t===0?0:n/t;i>=1&&(i=1-Number.EPSILON),r?.({percent:i,totalBytes:Math.max(t,n),transferredBytes:n},s)}s=a},flush(){s&&(n+=s.byteLength,r?.({percent:1,totalBytes:Math.max(t,n),transferredBytes:n},s))}}))},Je=(e,t)=>{if(!e.body)return e;if(e.status===204)return new Response(null,{status:e.status,statusText:e.statusText,headers:e.headers});const r=Math.max(0,Number(e.headers.get("content-length"))||0);return new Response(ue(e.body,r,t),{status:e.status,statusText:e.statusText,headers:e.headers})},We=(e,t,r)=>{if(!e.body)return e;const s=Be(r??e.body);return new Request(e,{duplex:"half",body:ue(e.body,s,t)})},R=e=>e!==null&&typeof e=="object",M=(...e)=>{for(const t of e)if((!R(t)||Array.isArray(t))&&t!==void 0)throw new TypeError("The `options` argument must be an object");return z({},...e)},ce=(e={},t={})=>{const r=new globalThis.Headers(e),s=t instanceof globalThis.Headers,n=new globalThis.Headers(t);for(const[a,o]of n.entries())s&&o==="undefined"||o===void 0?r.delete(a):r.set(a,o);return r};function _(e,t,r){return Object.hasOwn(t,r)&&t[r]===void 0?[]:z(e[r]??[],t[r]??[])}const he=(e={},t={})=>({beforeRequest:_(e,t,"beforeRequest"),beforeRetry:_(e,t,"beforeRetry"),afterResponse:_(e,t,"afterResponse"),beforeError:_(e,t,"beforeError")}),Ve=(e,t)=>{const r=new URLSearchParams;for(const s of[e,t])if(s!==void 0)if(s instanceof URLSearchParams)for(const[n,a]of s.entries())r.append(n,a);else if(Array.isArray(s))for(const n of s){if(!Array.isArray(n)||n.length!==2)throw new TypeError("Array search parameters must be provided in [[key, value], ...] format");r.append(String(n[0]),String(n[1]))}else if(R(s))for(const[n,a]of Object.entries(s))a!==void 0&&r.append(n,String(a));else{const n=new URLSearchParams(s);for(const[a,o]of n.entries())r.append(a,o)}return r},z=(...e)=>{let t={},r={},s={},n;const a=[];for(const o of e)if(Array.isArray(o))Array.isArray(t)||(t=[]),t=[...t,...o];else if(R(o)){for(let[i,u]of Object.entries(o)){if(i==="signal"&&u instanceof globalThis.AbortSignal){a.push(u);continue}if(i==="context"){if(u!=null&&(!R(u)||Array.isArray(u)))throw new TypeError("The `context` option must be an object");t={...t,context:u==null?{}:{...t.context,...u}};continue}if(i==="searchParams"){u==null?n=void 0:n=n===void 0?u:Ve(n,u);continue}R(u)&&i in t&&(u=z(t[i],u)),t={...t,[i]:u}}R(o.hooks)&&(s=he(s,o.hooks),t.hooks=s),R(o.headers)&&(r=ce(r,o.headers),t.headers=r)}return n!==void 0&&(t.searchParams=n),a.length>0&&(a.length===1?t.signal=a[0]:ne?t.signal=AbortSignal.any(a):t.signal=a.at(-1)),t},Ye=e=>oe.includes(e)?e.toUpperCase():e,Ge=["get","put","head","delete","options","trace"],Ke=[408,413,429,500,502,503,504],Xe=[413,429,503],X={limit:2,methods:Ge,statusCodes:Ke,afterStatusCodes:Xe,maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY,delay:e=>.3*2**(e-1)*1e3,jitter:void 0,retryOnTimeout:!1},Qe=(e={})=>{if(typeof e=="number")return{...X,limit:e};if(e.methods&&!Array.isArray(e.methods))throw new Error("retry.methods must be an array");if(e.methods&&=e.methods.map(r=>r.toLowerCase()),e.statusCodes&&!Array.isArray(e.statusCodes))throw new Error("retry.statusCodes must be an array");const t=Object.fromEntries(Object.entries(e).filter(([,r])=>r!==void 0));return{...X,...t}};class F extends Error{request;constructor(t){super(`Request timed out: ${t.method} ${t.url}`),this.name="TimeoutError",this.request=t}}async function Ze(e,t,r,s){return new Promise((n,a)=>{const o=setTimeout(()=>{r&&r.abort(),a(new F(e))},s.timeout);s.fetch(e,t).then(n).catch(a).then(()=>{clearTimeout(o)})})}async function et(e,{signal:t}){return new Promise((r,s)=>{t&&(t.throwIfAborted(),t.addEventListener("abort",n,{once:!0}));function n(){clearTimeout(a),s(t.reason)}const a=setTimeout(()=>{t?.removeEventListener("abort",n),r()},e)})}const tt=(e,t)=>{const r={};for(const s in t)Object.hasOwn(t,s)&&!(s in ze)&&!(s in $e)&&(!(s in e)||s in He)&&(r[s]=t[s]);return r},rt=e=>e===void 0?!1:Array.isArray(e)?e.length>0:e instanceof URLSearchParams?e.size>0:typeof e=="object"?Object.keys(e).length>0:typeof e=="string"?e.trim().length>0:!!e;function st(e){return e instanceof L||e?.name===L.name}function nt(e){return e instanceof F||e?.name===F.name}class N{static create(t,r){const s=new N(t,r),n=async()=>{if(typeof s.#e.timeout=="number"&&s.#e.timeout>U)throw new RangeError(`The \`timeout\` option cannot be greater than ${U}`);await Promise.resolve();let o=await s.#g();for(const i of s.#e.hooks.afterResponse){const u=s.#d(o.clone());let c;try{c=await i(s.request,s.#h(),u,{retryCount:s.#s})}catch(p){throw s.#c(u),s.#c(o),p}if(c instanceof ie)throw s.#c(u),s.#c(o),new C(c.options);const f=c instanceof globalThis.Response?c:o;u!==f&&s.#c(u),o!==f&&s.#c(o),o=f}if(s.#d(o),!o.ok&&(typeof s.#e.throwHttpErrors=="function"?s.#e.throwHttpErrors(o.status):s.#e.throwHttpErrors)){let i=new L(o,s.request,s.#h());for(const u of s.#e.hooks.beforeError)i=await u(i,{retryCount:s.#s});throw i}if(s.#e.onDownloadProgress){if(typeof s.#e.onDownloadProgress!="function")throw new TypeError("The `onDownloadProgress` option must be a function");if(!je)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");const i=o.clone();return s.#c(o),Je(i,s.#e.onDownloadProgress)}return o},a=s.#m(n).finally(()=>{const o=s.#n;s.#l(o?.body??void 0),s.#l(s.request.body??void 0)});for(const[o,i]of Object.entries(Ue))o==="bytes"&&typeof globalThis.Response?.prototype?.bytes!="function"||(a[o]=async()=>{s.request.headers.set("accept",s.request.headers.get("accept")||i);const u=await a;if(o==="json"){if(u.status===204)return"";const c=await u.text();return c===""?"":r.parseJson?r.parseJson(c):JSON.parse(c)}return u[o]()});return a}static#a(t){return t&&typeof t=="object"&&!Array.isArray(t)&&!(t instanceof URLSearchParams)?Object.fromEntries(Object.entries(t).filter(([,r])=>r!==void 0)):t}request;#t;#s=0;#r;#e;#n;#o;#i;constructor(t,r={}){if(this.#r=t,this.#e={...r,headers:ce(this.#r.headers,r.headers),hooks:he({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},r.hooks),method:Ye(r.method??this.#r.method??"GET"),prefixUrl:String(r.prefixUrl||""),retry:Qe(r.retry),throwHttpErrors:r.throwHttpErrors??!0,timeout:r.timeout??1e4,fetch:r.fetch??globalThis.fetch.bind(globalThis),context:r.context??{}},typeof this.#r!="string"&&!(this.#r instanceof URL||this.#r instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(this.#e.prefixUrl&&typeof this.#r=="string"){if(this.#r.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");this.#e.prefixUrl.endsWith("/")||(this.#e.prefixUrl+="/"),this.#r=this.#e.prefixUrl+this.#r}Oe&&ne&&(this.#o=this.#e.signal??this.#r.signal,this.#t=new globalThis.AbortController,this.#e.signal=this.#o?AbortSignal.any([this.#o,this.#t.signal]):this.#t.signal),K&&(this.#e.duplex="half"),this.#e.json!==void 0&&(this.#e.body=this.#e.stringifyJson?.(this.#e.json)??JSON.stringify(this.#e.json),this.#e.headers.set("content-type",this.#e.headers.get("content-type")??"application/json"));const s=r.headers&&new globalThis.Headers(r.headers).has("content-type");if(this.#r instanceof globalThis.Request&&(Ce&&this.#e.body instanceof globalThis.FormData||this.#e.body instanceof URLSearchParams)&&!s&&this.#e.headers.delete("content-type"),this.request=new globalThis.Request(this.#r,this.#e),rt(this.#e.searchParams)){const a="?"+(typeof this.#e.searchParams=="string"?this.#e.searchParams.replace(/^\?/,""):new URLSearchParams(N.#a(this.#e.searchParams)).toString()),o=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,a);this.request=new globalThis.Request(o,this.#e)}if(this.#e.onUploadProgress){if(typeof this.#e.onUploadProgress!="function")throw new TypeError("The `onUploadProgress` option must be a function");if(!K)throw new Error("Request streams are not supported in your environment. The `duplex` option for `Request` is not available.");this.request=this.#y(this.request,this.#e.body??void 0)}}#u(){const t=this.#e.retry.delay(this.#s);let r=t;this.#e.retry.jitter===!0?r=Math.random()*t:typeof this.#e.retry.jitter=="function"&&(r=this.#e.retry.jitter(t),(!Number.isFinite(r)||r<0)&&(r=t));const s=this.#e.retry.backoffLimit??Number.POSITIVE_INFINITY;return Math.min(s,r)}async#p(t){if(this.#s++,this.#s>this.#e.retry.limit)throw t;const r=t instanceof Error?t:new se(t);if(r instanceof C)return r.customDelay??this.#u();if(!this.#e.retry.methods.includes(this.request.method.toLowerCase()))throw t;if(this.#e.retry.shouldRetry!==void 0){const s=await this.#e.retry.shouldRetry({error:r,retryCount:this.#s});if(s===!1)throw t;if(s===!0)return this.#u()}if(nt(t)&&!this.#e.retry.retryOnTimeout)throw t;if(st(t)){if(!this.#e.retry.statusCodes.includes(t.response.status))throw t;const s=t.response.headers.get("Retry-After")??t.response.headers.get("RateLimit-Reset")??t.response.headers.get("X-RateLimit-Retry-After")??t.response.headers.get("X-RateLimit-Reset")??t.response.headers.get("X-Rate-Limit-Reset");if(s&&this.#e.retry.afterStatusCodes.includes(t.response.status)){let n=Number(s)*1e3;Number.isNaN(n)?n=Date.parse(s)-Date.now():n>=Date.parse("2024-01-01")&&(n-=Date.now());const a=this.#e.retry.maxRetryAfter??n;return n<a?n:a}if(t.response.status===413)throw t}return this.#u()}#d(t){return this.#e.parseJson&&(t.json=async()=>this.#e.parseJson(await t.text())),t}#l(t){t&&t.cancel().catch(()=>{})}#c(t){this.#l(t.body??void 0)}async#m(t){try{return await t()}catch(r){const s=Math.min(await this.#p(r),U);if(this.#s<1)throw r;if(await et(s,this.#o?{signal:this.#o}:{}),r instanceof C&&r.customRequest){const n=this.#e.signal?new globalThis.Request(r.customRequest,{signal:this.#e.signal}):new globalThis.Request(r.customRequest);this.#f(n)}for(const n of this.#e.hooks.beforeRetry){const a=await n({request:this.request,options:this.#h(),error:r,retryCount:this.#s});if(a instanceof globalThis.Request){this.#f(a);break}if(a instanceof globalThis.Response)return a;if(a===ae)return}return this.#m(t)}}async#g(){this.#t?.signal.aborted&&(this.#t=new globalThis.AbortController,this.#e.signal=this.#o?AbortSignal.any([this.#o,this.#t.signal]):this.#t.signal,this.request=new globalThis.Request(this.request,{signal:this.#e.signal}));for(const r of this.#e.hooks.beforeRequest){const s=await r(this.request,this.#h(),{retryCount:this.#s});if(s instanceof Response)return s;if(s instanceof globalThis.Request){this.#f(s);break}}const t=tt(this.request,this.#e);return this.#n=this.request,this.request=this.#n.clone(),this.#e.timeout===!1?this.#e.fetch(this.#n,t):Ze(this.#n,t,this.#t,this.#e)}#h(){if(!this.#i){const{hooks:t,...r}=this.#e;this.#i=Object.freeze(r)}return this.#i}#f(t){this.#i=void 0,this.request=this.#y(t)}#y(t,r){return!this.#e.onUploadProgress||!t.body?t:We(t,this.#e.onUploadProgress,r??this.#e.body??void 0)}}const $=e=>{const t=(r,s)=>N.create(r,M(e,s));for(const r of oe)t[r]=(s,n)=>N.create(s,M(e,n,{method:r}));return t.create=r=>$(M(r)),t.extend=r=>(typeof r=="function"&&(r=r(e??{})),$(M(e,r))),t.stop=ae,t.retry=Fe,t},ot=$(),Q={timeout:3e4,retry:{limit:3,methods:["GET"],statusCodes:[408,413,429,500,502,503,504]}},at=async(e,t)=>{d.debug("外部API取得開始:",e);try{const s=await(await ot.get(e,{timeout:Q.timeout,retry:Q.retry,signal:t})).text();if(d.debug("APIレスポンス長:",s.length),!s||s.trim().length===0){d.error("空レスポンス:",e);const n=new Error("Empty response from API");throw q(n,"外部APIから空のレスポンスが返されました",e)}try{const n=JSON.parse(s);return d.debug("外部API取得成功:",e),n}catch(n){throw d.error("JSONパースエラー:",{url:e,responseStart:s.substring(0,200),error:n}),new v(`Invalid JSON response from API: ${n instanceof Error?n.message:String(n)}`,n)}}catch(r){throw r instanceof v||d.error("外部API取得失敗:",e,r),r instanceof v?q(r,"外部APIのレスポンス形式が不正です",e):q(r,"外部APIへのアクセスに失敗しました",e)}};function it(){return{logger:d,externalFetcher:at,internalFetcher:fetch,createAppError:T}}function S(e){const t=it();if((Y(e)||G(e))&&!e.endpoint)throw new Error(`[${e.key}] endpoint is empty. Set the corresponding PUBLIC_API_ENDPOINT_* in .env`);if(Y(e))return ve(e,t);if(G(e))return qe(e,t);if(Pe(e))return Ie(e,t);const r=e;throw new Error(`Unknown data source type: ${r}`)}const l=()=>Se(e=>{if(e===void 0)return e;if(e===null)return null;if(typeof e=="number")return isNaN(e)?null:e;if(typeof e=="string"){const t=e.trim();if(t==="")return null;const r=parseFloat(t);return isNaN(r)?null:r}return null},ke().nullable()),ut=g({日付:w(),"病床利用率 (%)":l(),救急車搬入数:l(),入院患者数:l(),退院予定数:l(),一般病棟在院数:l(),集中治療室在院数:l(),平均在院日数:l(),手術件数:l().optional(),長期入院患者数:l().optional()}),ct=g({data:O(ut)}),ht=g({title:w()}),lt=g({data:g({card:g({title:w().optional()}).optional(),last_updated:w().optional(),items:O(ht).optional()})}),ft=g({title:w(),subtitle:w().optional(),tag:w().optional(),timestamp:w().optional()}),dt=g({data:g({items:O(ft)})}),mt=g({日付:w(),reha_empty_beds:l(),reha_bed_usage:l(),reha_performance_index:l(),reha_home_admission_rate:l(),reha_home_return_rate:l(),reha_ext_long_stay_patients:l(),reha_ext_bed_usage:l()});g({data:O(mt)});const le="2025-10-01";function yt(e,t=1){const r=e.getDay();return r===0||r===6?t:1}function E(e,t){return Math.round(e+(Math.random()-.5)*t)}function I(e,t,r,s=1){const n=yt(e,s);return Math.round(E(t,r)*n)}function fe(e,t){const[r,s,n]=e.split("-").map(Number),a=new Date(r,s-1,n),o=new Date;o.setHours(0,0,0,0);const i=[];for(let u=new Date(a);u<=o;u.setDate(u.getDate()+1)){const c=Z(u);i.push(t(u,c))}return i}function pt(e){return[...e].sort((t,r)=>t.日付.localeCompare(r.日付))}function gt(e){return pt(e.data)}const _t=S({type:"external",key:"dashboard",displayName:"ダッシュボード",endpoint:H.dashboard,schema:ct,transform:gt,errorMessage:"ダッシュボードデータの形式が不正です",polling:!0});function bt(e){const t=e.data;return d.info(`水曜会データ: ${t.items?.length||0}件`),{title:t.card?.title||"水曜会",lastUpdated:t.last_updated?new Date(t.last_updated).toLocaleString("ja-JP"):"--",items:t.items||[]}}const vt=S({type:"external",key:"suiyokai",displayName:"水曜会",endpoint:H.suiyokai,schema:lt,transform:bt,errorMessage:"水曜会データの形式が不正です",polling:!0}),qt=S({type:"external",key:"announcement",displayName:"お知らせ",endpoint:H.announcements,schema:dt,transform:Ne("お知らせ"),errorMessage:"お知らせデータの形式が不正です",polling:!0});function wt(){return fe(le,(e,t)=>({日付:t,"病床利用率 (%)":.75+(Math.random()-.5)*.2,救急車搬入数:I(e,35,20,.7),入院患者数:E(200,30),退院予定数:I(e,25,10,.5),一般病棟在院数:E(180,25),集中治療室在院数:E(12,6),平均在院日数:14+(Math.random()-.5)*4,手術件数:I(e,25,15,.3),長期入院患者数:E(12,6)}))}const It=S({type:"dummy",key:"dev-dashboard",displayName:"開発用ダッシュボード",generate:wt,errorMessage:"開発用ダッシュボードデータの生成に失敗しました",polling:!1,devOnly:!0});function Tt(){return fe(le,(e,t)=>({日付:t,reha_empty_beds:E(15,10),reha_bed_usage:.85+(Math.random()-.5)*.1,reha_performance_index:45+(Math.random()-.5)*10,reha_home_admission_rate:.6+(Math.random()-.5)*.1,reha_home_return_rate:.75+(Math.random()-.5)*.1,reha_ext_long_stay_patients:I(e,7,5,.7),reha_ext_bed_usage:.9+(Math.random()-.5)*.1}))}const Ot=S({type:"dummy",key:"dev-reha-dashboard",displayName:"開発用リハダッシュボード",generate:Tt,errorMessage:"開発用リハダッシュボードデータの生成に失敗しました",polling:!1,devOnly:!0}),Rt=[{id:"kyoritsu-001",slug:"kyoritsu",name:"戸畑共立病院",shortName:"共立",beds:218,type:"一般病院"},{id:"reha-001",slug:"reha",name:"戸畑リハビリテーション病院",shortName:"リハ",beds:120,type:"リハビリテーション病院"},{id:"ayame-001",slug:"ayame",name:"あやめの里",shortName:"あやめ",beds:80,type:"介護老人保健施設"},{id:"meiji-001",slug:"meiji",name:"明治町クリニック",shortName:"明治",beds:19,type:"診療所"}];function b(e,t){return Math.floor(Math.random()*(t-e+1))+e}function P(e,t,r=1){const s=Math.random()*(t-e)+e;return Number(s.toFixed(r))}function Et(e,t){const r=t==="一般病院"?85:t==="リハビリテーション病院"?90:75,s=P(r-10,r+5,1),n=Math.round(e*s/100),a=e-n,o=P(s-5,s+5,1),i=e/100,u=b(Math.floor(50*i),Math.floor(150*i)),c=n,f=b(Math.floor(5*i),Math.floor(15*i)),p=b(Math.floor(3*i),Math.floor(12*i)),m=P(12,25,1),k=b(Math.floor(e*2),Math.floor(e*3)),D=P(75,95,1),de=b(Math.floor(e*.3),Math.floor(e*.5)),me=b(Math.floor(e*.05),Math.floor(e*.1)),A=b(Math.floor(e*50),Math.floor(e*100)),B=b(Math.floor(A*.7),Math.floor(A*.9)),J=A-B,ye=Number((J/A*100).toFixed(1));return{bedUtilization:s,usedBeds:n,availableBeds:a,occupancyRate:o,outpatients:u,inpatients:c,newAdmissions:f,discharges:p,avgStayDays:m,staffUtilization:D,totalStaff:k,nursesOnDuty:de,doctorsOnDuty:me,revenue:A,costs:B,profit:J,profitMargin:ye}}function St(e,t){const r=[],s=new Date,n=t==="一般病院"?85:t==="リハビリテーション病院"?90:75,a=e/100;for(let o=29;o>=0;o--){const i=new Date(s);i.setDate(i.getDate()-o);const u=Z(i),c=i.getDay(),f=c===0||c===6?.7:1,p=P(-5,5,1),m=Number((n+p).toFixed(1)),k=Math.round(b(Math.floor(50*a),Math.floor(150*a))*f),D=Math.round(e*m/100);r.push({date:u,bedUtilization:m,outpatients:k,inpatients:D})}return r}function kt(){return Rt.map(e=>({id:e.id,slug:e.slug,name:e.name,shortName:e.shortName,beds:e.beds,type:e.type,kpis:Et(e.beds,e.type),trend:St(e.beds,e.type)}))}const jt=S({type:"dummy",key:"dev-total-metrics",displayName:"開発用全体指標",generate:kt,errorMessage:"開発用全体指標データの生成に失敗しました",polling:!1,devOnly:!0});export{j as D,Mt as _,qt as a,It as b,Ot as c,_t as d,jt as e,Nt as f,T as g,vt as s,q as t};
