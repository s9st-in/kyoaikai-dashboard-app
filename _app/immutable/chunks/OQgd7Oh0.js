import{v as Ee,H as Q,I as Ae,E as Pe,J as xe,M as ve,N as Me,O as ee,K as Ie,P as Ne,bc as H,bd as ke,be as ue,g as d,ad as Oe,h,bf as qe,ag as V,bg as Ue,ab as Fe,bh as Le,o as je,aJ as Ce,bi as $e,bj as Je,B as Be,bk as ze,ae as te,ap as re,b9 as v,S as ce,aN as le,bl as He,i as M,aO as We}from"./p4dYvpg6.js";import{B as Ye}from"./CoqMnC_w.js";import{c as Ge}from"./BzlezhIL.js";import{D as L,l as m}from"./BhIsClV-.js";import{o as g,a as j,s as _,p as Ve,n as Ke}from"./DGs5A2D8.js";import{t as U,c as Xe,J as $,a as Ze}from"./DiPxs-5a.js";function fr(e,t,r){var s;Q&&(s=Ne,Ae());var n=new Ye(e);Ee(()=>{var o=t()??null;if(Q){var a=xe(s),u=a===Ie,i=o!==null;if(u!==i){var c=ve();Me(c),n.anchor=c,ee(!1),n.ensure(o,o&&(l=>r(l,o))),ee(!0);return}}n.ensure(o,o&&(l=>r(l,o)))},Pe)}const Qe={get(e,t){if(!e.exclude.includes(t))return e.props[t]},set(e,t){return!1},getOwnPropertyDescriptor(e,t){if(!e.exclude.includes(t)&&t in e.props)return{enumerable:!0,configurable:!0,value:e.props[t]}},has(e,t){return e.exclude.includes(t)?!1:t in e.props},ownKeys(e){return Reflect.ownKeys(e.props).filter(t=>!e.exclude.includes(t))}};function dr(e,t,r){return new Proxy({props:e,exclude:t},Qe)}const et={get(e,t){if(!e.exclude.includes(t))return d(e.version),t in e.special?e.special[t]():e.props[t]},set(e,t,r){if(!(t in e.special)){var s=V;try{re(e.parent_effect),e.special[t]=rt({get[t](){return e.props[t]}},t,ue)}finally{re(s)}}return e.special[t](r),te(e.version),!0},getOwnPropertyDescriptor(e,t){if(!e.exclude.includes(t)&&t in e.props)return{enumerable:!0,configurable:!0,value:e.props[t]}},deleteProperty(e,t){return e.exclude.includes(t)||(e.exclude.push(t),te(e.version)),!0},has(e,t){return e.exclude.includes(t)?!1:t in e.props},ownKeys(e){return Reflect.ownKeys(e.props).filter(t=>!e.exclude.includes(t))}};function pr(e,t){return new Proxy({props:e,exclude:t,special:{},version:Fe(0),parent_effect:V},et)}const tt={get(e,t){let r=e.props.length;for(;r--;){let s=e.props[r];if(v(s)&&(s=s()),typeof s=="object"&&s!==null&&t in s)return s[t]}},set(e,t,r){let s=e.props.length;for(;s--;){let n=e.props[s];v(n)&&(n=n());const o=H(n,t);if(o&&o.set)return o.set(r),!0}return!1},getOwnPropertyDescriptor(e,t){let r=e.props.length;for(;r--;){let s=e.props[r];if(v(s)&&(s=s()),typeof s=="object"&&s!==null&&t in s){const n=H(s,t);return n&&!n.configurable&&(n.configurable=!0),n}}},has(e,t){if(t===ce||t===le)return!1;for(let r of e.props)if(v(r)&&(r=r()),r!=null&&t in r)return!0;return!1},ownKeys(e){const t=[];for(let r of e.props)if(v(r)&&(r=r()),!!r){for(const s in r)t.includes(s)||t.push(s);for(const s of Object.getOwnPropertySymbols(r))t.includes(s)||t.push(s)}return t}};function mr(...e){return new Proxy({props:e},tt)}function rt(e,t,r,s){var n=!Ce||(r&$e)!==0,o=(r&Le)!==0,a=(r&He)!==0,u=s,i=!0,c=()=>(i&&(i=!1,u=a?je(s):s),u),l;if(o){var S=ce in e||le in e;l=H(e,t)?.set??(S&&t in e?f=>e[t]=f:void 0)}var b,D=!1;o?[b,D]=Ge(()=>e[t]):b=e[t],b===void 0&&s!==void 0&&(b=c(),l&&(n&&ke(),l(b)));var w;if(n?w=()=>{var f=e[t];return f===void 0?c():(i=!0,f)}:w=()=>{var f=e[t];return f!==void 0&&(u=void 0),f===void 0?u:f},n&&(r&ue)===0)return w;if(l){var C=e.$$legacy;return(function(f,E){return arguments.length>0?((!n||!E||C||D)&&l(E?w():f),f):w()})}var x=!1,y=((r&Je)!==0?Be:ze)(()=>(x=!1,w()));o&&d(y);var k=V;return(function(f,E){if(arguments.length>0){const Z=E?d(y):n&&o?Oe(f):f;return h(y,Z),x=!0,u!==void 0&&(u=Z),f}return qe&&x||(k.f&Ue)!==0?y.v:d(y)})}function st(e,t=L){return t<=0||!Number.isFinite(t)?!1:e>0&&Date.now()-e<t}function se(e){return e.type==="external"}function ne(e){return e.type==="internal"}function nt(e){return e.type==="dummy"}const ot=540*60*1e3,at=["日","月","火","水","木","金","土"],it={Sun:"日",Sunday:"日",Mon:"月",Monday:"月",Tue:"火",Tuesday:"火",Wed:"水",Wednesday:"水",Thu:"木",Thursday:"木",Fri:"金",Friday:"金",Sat:"土",Saturday:"土"};function ut(e){return at[e.getDay()]}function yr(e){return it[e]??e}function gr(e,t){const r=typeof e=="number"?new Date(e):e;if(isNaN(r.getTime()))throw new TypeError("Invalid date input");const{includeTime:s=!1,includeWeekday:n=!0}={},o=r.getFullYear(),a=r.getMonth()+1,u=r.getDate();let i=`${o}年${a}月${u}日`;if(n){const c=ut(r);i+=`（${c}）`}if(s){const c=r.getHours(),l=r.getMinutes().toString().padStart(2,"0");i+=` ${c}時${l}分`}return i}function br(e){return new Date(e).toLocaleString("ja-JP")}function he(e){const t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${r}-${s}`}function fe(e){const t=new Date(e+ot),r=t.getUTCFullYear(),s=String(t.getUTCMonth()+1).padStart(2,"0"),n=String(t.getUTCDate()).padStart(2,"0");return`${r}-${s}-${n}`}function wr(e=new Date){return fe(e.getTime())}function Tr(e=new Date){return fe(e.getTime()-864e5)}function ct(e){return t=>{const r=t.data.items;return m.info(`${e}データ: ${r.length}件`),r}}class de{key;displayName;type;isDummy;polling;pollingInterval;#a=M(null);#t=M(!1);#s=M(null);#r=M(0);#e=M(!1);#n=null;#o;#i;constructor(t){this.key=t.key,this.displayName=t.displayName,this.type=t.type,this.isDummy=t.isDummy,this.polling=t.polling,this.#i=t.ttlMs??L,this.pollingInterval=t.pollingInterval??this.#i,this.#o=t.fetchFn}getData(){return d(this.#a)}isLoading(){return d(this.#t)}getError(){return d(this.#s)}getTimestamp(){return d(this.#r)}async fetch(t=!1){if(!t&&this.isCacheValid)return m.debug(`[${this.key}] キャッシュ有効、スキップ`),d(this.#a);this.#u();const r=new AbortController;this.#n=r,h(this.#t,!0),h(this.#s,null);try{m.debug(`[${this.key}] 取得開始`);const s=await this.#o(r.signal);return r.signal.aborted?(h(this.#t,!1),null):(h(this.#a,s,!0),h(this.#r,Date.now(),!0),h(this.#t,!1),h(this.#s,null),m.info(`[${this.key}] 取得成功`),s)}catch(s){if(r.signal.aborted)return h(this.#t,!1),null;const n=U(s,`${this.displayName}データの取得に失敗しました`);return h(this.#t,!1),h(this.#s,n,!0),m.error(`[${this.key}] 取得エラー:`,s),null}}clear(){h(this.#a,null),h(this.#r,0),h(this.#s,null),h(this.#t,!1),m.debug(`[${this.key}] クリア`)}abort(){this.#u(),d(this.#t)&&h(this.#t,!1)}activate(){h(this.#e,!0),!this.isCacheValid&&!d(this.#t)&&this.fetch()}deactivate(){h(this.#e,!1),this.#u(),d(this.#t)&&h(this.#t,!1)}get isActive(){return d(this.#e)}get isCacheValid(){return d(this.#a)!==null&&st(d(this.#r),this.#i)}get hasStaleData(){return d(this.#a)!==null&&d(this.#s)!==null}#u(){this.#n&&(this.#n.abort(),this.#n=null)}}function lt(e){const{key:t,schema:r,transform:s,errorMessage:n,logger:o,createAppError:a,endpoint:u}=e;return i=>{const c=r.safeParse(i);if(!c.success)throw o.error(`[${t}] データ検証エラー:`,c.error),a("validation",n,c.error.message,u);return s(c.data)}}function pe(e){const{config:t,dependencies:r,fetcher:s}=e,n=lt({key:t.key,schema:t.schema,transform:t.transform,errorMessage:t.errorMessage,logger:r.logger,createAppError:r.createAppError,endpoint:t.endpoint}),o=s(n);return new de({key:t.key,displayName:t.displayName,type:t.type,isDummy:!1,polling:t.polling??!1,ttlMs:t.cache?.ttlMs??L,pollingInterval:t.pollingInterval,fetchFn:a=>o(a)})}function ht(e,t){return pe({config:e,dependencies:t,fetcher:r=>async s=>{const n=await t.externalFetcher(e.endpoint,s);return r(n)}})}function ft(e,t){return pe({config:e,dependencies:t,fetcher:r=>async s=>{const n=await t.internalFetcher(e.endpoint,{signal:s});if(!n.ok){const a=Xe(n.status);throw t.createAppError(a,e.errorMessage,`HTTP ${n.status}: ${n.statusText}`,e.endpoint)}const o=await n.json();return r(o)}})}function dt(e,t){const{logger:r}=t,s=e.devOnly!==!1;return new de({key:e.key,displayName:e.displayName,type:"dummy",isDummy:!0,polling:e.polling??!1,ttlMs:e.cache?.ttlMs??L,pollingInterval:e.pollingInterval,fetchFn:async()=>{if(s&&!We)return r.warn(`[${e.key}] Dummy data source is disabled in production`),null;r.debug(`[${e.key}] Generating dummy data...`);const n=await Promise.resolve(e.generate());return r.info(`${e.displayName}ダミーデータ生成完了`),n}})}class W extends Error{response;request;options;constructor(t,r,s){const n=t.status||t.status===0?t.status:"",o=t.statusText??"",a=`${n} ${o}`.trim(),u=a?`status code ${a}`:"an unknown error";super(`Request failed with ${u}: ${r.method} ${r.url}`),this.name="HTTPError",this.response=t,this.request=r,this.options=s}}class me extends Error{name="NonError";value;constructor(t){let r="Non-error value was thrown";try{typeof t=="string"?r=t:t&&typeof t=="object"&&"message"in t&&typeof t.message=="string"&&(r=t.message)}catch{}super(r),this.value=t}}class J extends Error{name="ForceRetryError";customDelay;code;customRequest;constructor(t){const r=t?.cause?t.cause instanceof Error?t.cause:new me(t.cause):void 0;super(t?.code?`Forced retry: ${t.code}`:"Forced retry",r?{cause:r}:void 0),this.customDelay=t?.delay,this.code=t?.code,this.customRequest=t?.request}}const oe=(()=>{let e=!1,t=!1;const r=typeof globalThis.ReadableStream=="function",s=typeof globalThis.Request=="function";if(r&&s)try{t=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type")}catch(n){if(n instanceof Error&&n.message==="unsupported BodyInit type")return!1;throw n}return e&&!t})(),pt=typeof globalThis.AbortController=="function",ye=typeof globalThis.AbortSignal=="function"&&typeof globalThis.AbortSignal.any=="function",mt=typeof globalThis.ReadableStream=="function",yt=typeof globalThis.FormData=="function",ge=["get","post","put","patch","head","delete"],gt={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*",bytes:"*/*"},B=2147483647,bt=new TextEncoder().encode("------WebKitFormBoundaryaxpyiPgbbPti10Rw").length,be=Symbol("stop");class we{options;constructor(t){this.options=t}}const wt=e=>new we(e),Tt={json:!0,parseJson:!0,stringifyJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,onUploadProgress:!0,fetch:!0,context:!0},_t={next:!0},St={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,duplex:!0},Rt=e=>{if(!e)return 0;if(e instanceof FormData){let t=0;for(const[r,s]of e)t+=bt,t+=new TextEncoder().encode(`Content-Disposition: form-data; name="${r}"`).length,t+=typeof s=="string"?new TextEncoder().encode(s).length:s.size;return t}if(e instanceof Blob)return e.size;if(e instanceof ArrayBuffer)return e.byteLength;if(typeof e=="string")return new TextEncoder().encode(e).length;if(e instanceof URLSearchParams)return new TextEncoder().encode(e.toString()).length;if("byteLength"in e)return e.byteLength;if(typeof e=="object"&&e!==null)try{const t=JSON.stringify(e);return new TextEncoder().encode(t).length}catch{return 0}return 0},Te=(e,t,r)=>{let s,n=0;return e.pipeThrough(new TransformStream({transform(o,a){if(a.enqueue(o),s){n+=s.byteLength;let u=t===0?0:n/t;u>=1&&(u=1-Number.EPSILON),r?.({percent:u,totalBytes:Math.max(t,n),transferredBytes:n},s)}s=o},flush(){s&&(n+=s.byteLength,r?.({percent:1,totalBytes:Math.max(t,n),transferredBytes:n},s))}}))},Dt=(e,t)=>{if(!e.body)return e;if(e.status===204)return new Response(null,{status:e.status,statusText:e.statusText,headers:e.headers});const r=Math.max(0,Number(e.headers.get("content-length"))||0);return new Response(Te(e.body,r,t),{status:e.status,statusText:e.statusText,headers:e.headers})},Et=(e,t,r)=>{if(!e.body)return e;const s=Rt(r??e.body);return new Request(e,{duplex:"half",body:Te(e.body,s,t)})},R=e=>e!==null&&typeof e=="object",O=(...e)=>{for(const t of e)if((!R(t)||Array.isArray(t))&&t!==void 0)throw new TypeError("The `options` argument must be an object");return K({},...e)},_e=(e={},t={})=>{const r=new globalThis.Headers(e),s=t instanceof globalThis.Headers,n=new globalThis.Headers(t);for(const[o,a]of n.entries())s&&a==="undefined"||a===void 0?r.delete(o):r.set(o,a);return r};function q(e,t,r){return Object.hasOwn(t,r)&&t[r]===void 0?[]:K(e[r]??[],t[r]??[])}const Se=(e={},t={})=>({beforeRequest:q(e,t,"beforeRequest"),beforeRetry:q(e,t,"beforeRetry"),afterResponse:q(e,t,"afterResponse"),beforeError:q(e,t,"beforeError")}),At=(e,t)=>{const r=new URLSearchParams;for(const s of[e,t])if(s!==void 0)if(s instanceof URLSearchParams)for(const[n,o]of s.entries())r.append(n,o);else if(Array.isArray(s))for(const n of s){if(!Array.isArray(n)||n.length!==2)throw new TypeError("Array search parameters must be provided in [[key, value], ...] format");r.append(String(n[0]),String(n[1]))}else if(R(s))for(const[n,o]of Object.entries(s))o!==void 0&&r.append(n,String(o));else{const n=new URLSearchParams(s);for(const[o,a]of n.entries())r.append(o,a)}return r},K=(...e)=>{let t={},r={},s={},n;const o=[];for(const a of e)if(Array.isArray(a))Array.isArray(t)||(t=[]),t=[...t,...a];else if(R(a)){for(let[u,i]of Object.entries(a)){if(u==="signal"&&i instanceof globalThis.AbortSignal){o.push(i);continue}if(u==="context"){if(i!=null&&(!R(i)||Array.isArray(i)))throw new TypeError("The `context` option must be an object");t={...t,context:i==null?{}:{...t.context,...i}};continue}if(u==="searchParams"){i==null?n=void 0:n=n===void 0?i:At(n,i);continue}R(i)&&u in t&&(i=K(t[u],i)),t={...t,[u]:i}}R(a.hooks)&&(s=Se(s,a.hooks),t.hooks=s),R(a.headers)&&(r=_e(r,a.headers),t.headers=r)}return n!==void 0&&(t.searchParams=n),o.length>0&&(o.length===1?t.signal=o[0]:ye?t.signal=AbortSignal.any(o):t.signal=o.at(-1)),t},Pt=e=>ge.includes(e)?e.toUpperCase():e,xt=["get","put","head","delete","options","trace"],vt=[408,413,429,500,502,503,504],Mt=[413,429,503],ae={limit:2,methods:xt,statusCodes:vt,afterStatusCodes:Mt,maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY,delay:e=>.3*2**(e-1)*1e3,jitter:void 0,retryOnTimeout:!1},It=(e={})=>{if(typeof e=="number")return{...ae,limit:e};if(e.methods&&!Array.isArray(e.methods))throw new Error("retry.methods must be an array");if(e.methods&&=e.methods.map(r=>r.toLowerCase()),e.statusCodes&&!Array.isArray(e.statusCodes))throw new Error("retry.statusCodes must be an array");const t=Object.fromEntries(Object.entries(e).filter(([,r])=>r!==void 0));return{...ae,...t}};class Y extends Error{request;constructor(t){super(`Request timed out: ${t.method} ${t.url}`),this.name="TimeoutError",this.request=t}}async function Nt(e,t,r,s){return new Promise((n,o)=>{const a=setTimeout(()=>{r&&r.abort(),o(new Y(e))},s.timeout);s.fetch(e,t).then(n).catch(o).then(()=>{clearTimeout(a)})})}async function kt(e,{signal:t}){return new Promise((r,s)=>{t&&(t.throwIfAborted(),t.addEventListener("abort",n,{once:!0}));function n(){clearTimeout(o),s(t.reason)}const o=setTimeout(()=>{t?.removeEventListener("abort",n),r()},e)})}const Ot=(e,t)=>{const r={};for(const s in t)Object.hasOwn(t,s)&&!(s in St)&&!(s in Tt)&&(!(s in e)||s in _t)&&(r[s]=t[s]);return r},qt=e=>e===void 0?!1:Array.isArray(e)?e.length>0:e instanceof URLSearchParams?e.size>0:typeof e=="object"?Object.keys(e).length>0:typeof e=="string"?e.trim().length>0:!!e;function Ut(e){return e instanceof W||e?.name===W.name}function Ft(e){return e instanceof Y||e?.name===Y.name}class N{static create(t,r){const s=new N(t,r),n=async()=>{if(typeof s.#e.timeout=="number"&&s.#e.timeout>B)throw new RangeError(`The \`timeout\` option cannot be greater than ${B}`);await Promise.resolve();let a=await s.#g();for(const u of s.#e.hooks.afterResponse){const i=s.#d(a.clone());let c;try{c=await u(s.request,s.#l(),i,{retryCount:s.#s})}catch(S){throw s.#c(i),s.#c(a),S}if(c instanceof we)throw s.#c(i),s.#c(a),new J(c.options);const l=c instanceof globalThis.Response?c:a;i!==l&&s.#c(i),a!==l&&s.#c(a),a=l}if(s.#d(a),!a.ok&&(typeof s.#e.throwHttpErrors=="function"?s.#e.throwHttpErrors(a.status):s.#e.throwHttpErrors)){let u=new W(a,s.request,s.#l());for(const i of s.#e.hooks.beforeError)u=await i(u,{retryCount:s.#s});throw u}if(s.#e.onDownloadProgress){if(typeof s.#e.onDownloadProgress!="function")throw new TypeError("The `onDownloadProgress` option must be a function");if(!mt)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");const u=a.clone();return s.#c(a),Dt(u,s.#e.onDownloadProgress)}return a},o=s.#p(n).finally(()=>{const a=s.#n;s.#h(a?.body??void 0),s.#h(s.request.body??void 0)});for(const[a,u]of Object.entries(gt))a==="bytes"&&typeof globalThis.Response?.prototype?.bytes!="function"||(o[a]=async()=>{s.request.headers.set("accept",s.request.headers.get("accept")||u);const i=await o;if(a==="json"){if(i.status===204)return"";const c=await i.text();return c===""?"":r.parseJson?r.parseJson(c):JSON.parse(c)}return i[a]()});return o}static#a(t){return t&&typeof t=="object"&&!Array.isArray(t)&&!(t instanceof URLSearchParams)?Object.fromEntries(Object.entries(t).filter(([,r])=>r!==void 0)):t}request;#t;#s=0;#r;#e;#n;#o;#i;constructor(t,r={}){if(this.#r=t,this.#e={...r,headers:_e(this.#r.headers,r.headers),hooks:Se({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},r.hooks),method:Pt(r.method??this.#r.method??"GET"),prefixUrl:String(r.prefixUrl||""),retry:It(r.retry),throwHttpErrors:r.throwHttpErrors??!0,timeout:r.timeout??1e4,fetch:r.fetch??globalThis.fetch.bind(globalThis),context:r.context??{}},typeof this.#r!="string"&&!(this.#r instanceof URL||this.#r instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(this.#e.prefixUrl&&typeof this.#r=="string"){if(this.#r.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");this.#e.prefixUrl.endsWith("/")||(this.#e.prefixUrl+="/"),this.#r=this.#e.prefixUrl+this.#r}pt&&ye&&(this.#o=this.#e.signal??this.#r.signal,this.#t=new globalThis.AbortController,this.#e.signal=this.#o?AbortSignal.any([this.#o,this.#t.signal]):this.#t.signal),oe&&(this.#e.duplex="half"),this.#e.json!==void 0&&(this.#e.body=this.#e.stringifyJson?.(this.#e.json)??JSON.stringify(this.#e.json),this.#e.headers.set("content-type",this.#e.headers.get("content-type")??"application/json"));const s=r.headers&&new globalThis.Headers(r.headers).has("content-type");if(this.#r instanceof globalThis.Request&&(yt&&this.#e.body instanceof globalThis.FormData||this.#e.body instanceof URLSearchParams)&&!s&&this.#e.headers.delete("content-type"),this.request=new globalThis.Request(this.#r,this.#e),qt(this.#e.searchParams)){const o="?"+(typeof this.#e.searchParams=="string"?this.#e.searchParams.replace(/^\?/,""):new URLSearchParams(N.#a(this.#e.searchParams)).toString()),a=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,o);this.request=new globalThis.Request(a,this.#e)}if(this.#e.onUploadProgress){if(typeof this.#e.onUploadProgress!="function")throw new TypeError("The `onUploadProgress` option must be a function");if(!oe)throw new Error("Request streams are not supported in your environment. The `duplex` option for `Request` is not available.");this.request=this.#m(this.request,this.#e.body??void 0)}}#u(){const t=this.#e.retry.delay(this.#s);let r=t;this.#e.retry.jitter===!0?r=Math.random()*t:typeof this.#e.retry.jitter=="function"&&(r=this.#e.retry.jitter(t),(!Number.isFinite(r)||r<0)&&(r=t));const s=this.#e.retry.backoffLimit??Number.POSITIVE_INFINITY;return Math.min(s,r)}async#y(t){if(this.#s++,this.#s>this.#e.retry.limit)throw t;const r=t instanceof Error?t:new me(t);if(r instanceof J)return r.customDelay??this.#u();if(!this.#e.retry.methods.includes(this.request.method.toLowerCase()))throw t;if(this.#e.retry.shouldRetry!==void 0){const s=await this.#e.retry.shouldRetry({error:r,retryCount:this.#s});if(s===!1)throw t;if(s===!0)return this.#u()}if(Ft(t)&&!this.#e.retry.retryOnTimeout)throw t;if(Ut(t)){if(!this.#e.retry.statusCodes.includes(t.response.status))throw t;const s=t.response.headers.get("Retry-After")??t.response.headers.get("RateLimit-Reset")??t.response.headers.get("X-RateLimit-Retry-After")??t.response.headers.get("X-RateLimit-Reset")??t.response.headers.get("X-Rate-Limit-Reset");if(s&&this.#e.retry.afterStatusCodes.includes(t.response.status)){let n=Number(s)*1e3;Number.isNaN(n)?n=Date.parse(s)-Date.now():n>=Date.parse("2024-01-01")&&(n-=Date.now());const o=this.#e.retry.maxRetryAfter??n;return n<o?n:o}if(t.response.status===413)throw t}return this.#u()}#d(t){return this.#e.parseJson&&(t.json=async()=>this.#e.parseJson(await t.text())),t}#h(t){t&&t.cancel().catch(()=>{})}#c(t){this.#h(t.body??void 0)}async#p(t){try{return await t()}catch(r){const s=Math.min(await this.#y(r),B);if(this.#s<1)throw r;if(await kt(s,this.#o?{signal:this.#o}:{}),r instanceof J&&r.customRequest){const n=this.#e.signal?new globalThis.Request(r.customRequest,{signal:this.#e.signal}):new globalThis.Request(r.customRequest);this.#f(n)}for(const n of this.#e.hooks.beforeRetry){const o=await n({request:this.request,options:this.#l(),error:r,retryCount:this.#s});if(o instanceof globalThis.Request){this.#f(o);break}if(o instanceof globalThis.Response)return o;if(o===be)return}return this.#p(t)}}async#g(){this.#t?.signal.aborted&&(this.#t=new globalThis.AbortController,this.#e.signal=this.#o?AbortSignal.any([this.#o,this.#t.signal]):this.#t.signal,this.request=new globalThis.Request(this.request,{signal:this.#e.signal}));for(const r of this.#e.hooks.beforeRequest){const s=await r(this.request,this.#l(),{retryCount:this.#s});if(s instanceof Response)return s;if(s instanceof globalThis.Request){this.#f(s);break}}const t=Ot(this.request,this.#e);return this.#n=this.request,this.request=this.#n.clone(),this.#e.timeout===!1?this.#e.fetch(this.#n,t):Nt(this.#n,t,this.#t,this.#e)}#l(){if(!this.#i){const{hooks:t,...r}=this.#e;this.#i=Object.freeze(r)}return this.#i}#f(t){this.#i=void 0,this.request=this.#m(t)}#m(t,r){return!this.#e.onUploadProgress||!t.body?t:Et(t,this.#e.onUploadProgress,r??this.#e.body??void 0)}}const G=e=>{const t=(r,s)=>N.create(r,O(e,s));for(const r of ge)t[r]=(s,n)=>N.create(s,O(e,n,{method:r}));return t.create=r=>G(O(r)),t.extend=r=>(typeof r=="function"&&(r=r(e??{})),G(O(e,r))),t.stop=be,t.retry=wt,t},Lt=G(),ie={timeout:3e4,retry:{limit:3,methods:["GET"],statusCodes:[408,413,429,500,502,503,504]}},jt=async(e,t)=>{m.debug("外部API取得開始:",e);try{const s=await(await Lt.get(e,{timeout:ie.timeout,retry:ie.retry,signal:t})).text();if(m.debug("APIレスポンス長:",s.length),!s||s.trim().length===0){m.error("空レスポンス:",e);const n=new Error("Empty response from API");throw U(n,"外部APIから空のレスポンスが返されました",e)}try{const n=JSON.parse(s);return m.debug("外部API取得成功:",e),n}catch(n){throw m.error("JSONパースエラー:",{url:e,responseStart:s.substring(0,200),error:n}),new $(`Invalid JSON response from API: ${n instanceof Error?n.message:String(n)}`,n)}}catch(r){throw r instanceof $||m.error("外部API取得失敗:",e,r),r instanceof $?U(r,"外部APIのレスポンス形式が不正です",e):U(r,"外部APIへのアクセスに失敗しました",e)}};function Ct(){return{logger:m,externalFetcher:jt,internalFetcher:fetch,createAppError:Ze}}function P(e){const t=Ct();if((se(e)||ne(e))&&!e.endpoint)throw new Error(`[${e.key}] endpoint is empty. Set the corresponding PUBLIC_API_ENDPOINT_* in .env`);if(se(e))return ht(e,t);if(ne(e))return ft(e,t);if(nt(e))return dt(e,t);const r=e;throw new Error(`Unknown data source type: ${r}`)}const p=()=>Ve(e=>{if(e===void 0)return e;if(e===null)return null;if(typeof e=="number")return isNaN(e)?null:e;if(typeof e=="string"){const t=e.trim();if(t==="")return null;const r=parseFloat(t);return isNaN(r)?null:r}return null},Ke().nullable()),$t=g({日付:_(),"病床利用率 (%)":p(),救急車搬入数:p(),入院患者数:p(),退院予定数:p(),一般病棟在院数:p(),集中治療室在院数:p(),平均在院日数:p(),手術件数:p(),"長期入院者数（30日）":p()}),Jt=g({data:j($t)}),Bt=g({title:_()}),zt=g({data:g({card:g({title:_().optional()}).optional(),last_updated:_().optional(),items:j(Bt).optional()})}),Ht=g({title:_(),subtitle:_().optional(),tag:_().optional(),timestamp:_().optional()}),Wt=g({data:g({items:j(Ht)})}),Yt=g({日付:_(),reha_empty_beds:p(),reha_bed_usage:p(),reha_performance_index:p(),reha_home_admission_rate:p(),reha_home_return_rate:p(),reha_ext_long_stay_patients:p(),reha_ext_bed_usage:p()});g({data:j(Yt)});const Gt="static-ghpages",Vt="static",Kt=Vt==="static",_r=Gt==="static-ghpages",Sr=Kt,Rr="production",Dr="2026-03-01T12:10:53.874Z",Er={shortHash:"5260437",date:"2026-03-01 21:05:44 +0900",branch:"refactor/code-20260301"},z={dashboard:"https://script.google.com/macros/s/AKfycbwor8y2k5p2zXUcIj7rBnyn3Z_V4cTyEgcyGzGnvy_VgAjam2ymmMFJNy0xUvnTuzjt/exec",suiyokai:"https://script.google.com/macros/s/AKfycbz2vWPO7bmwFd_3LrdcRrgTk-JoLHPp_BflUQo96GN79R__M7yUp209g5FLWTnRya3B/exec",announcements:"https://script.google.com/macros/s/AKfycbz87qFFmnxVd7rJWO9WXsiX776Ci5IK4MhUWN9z-wc6JEbJLuMRa50-3nV1oznIGS4R/exec"},X={dashboard:z.dashboard,suiyokai:z.suiyokai,announcements:z.announcements};function Xt(e){return[...e].sort((t,r)=>t.日付.localeCompare(r.日付))}const Ar=P({type:"external",key:"dashboard",displayName:"ダッシュボード",endpoint:X.dashboard,schema:Jt,transform:e=>Xt(e.data),errorMessage:"ダッシュボードデータの形式が不正です",polling:!0});function Zt(e){const t=e.data;return m.info(`水曜会データ: ${t.items?.length||0}件`),{title:t.card?.title||"水曜会",lastUpdated:t.last_updated?new Date(t.last_updated).toLocaleString("ja-JP"):"--",items:t.items||[]}}const Pr=P({type:"external",key:"suiyokai",displayName:"水曜会",endpoint:X.suiyokai,schema:zt,transform:Zt,errorMessage:"水曜会データの形式が不正です",polling:!0}),xr=P({type:"external",key:"announcement",displayName:"お知らせ",endpoint:X.announcements,schema:Wt,transform:ct("お知らせ"),errorMessage:"お知らせデータの形式が不正です",polling:!0}),Re="2025-10-01";function Qt(e,t=1){const r=e.getDay();return r===0||r===6?t:1}function A(e,t){return Math.round(e+(Math.random()-.5)*t)}function F(e,t,r,s=1){const n=Qt(e,s);return Math.round(A(t,r)*n)}function De(e,t){const[r,s,n]=e.split("-").map(Number),o=new Date(r,s-1,n),a=new Date;a.setHours(0,0,0,0);const u=[];for(let i=new Date(o);i<=a;i.setDate(i.getDate()+1)){const c=he(i);u.push(t(i,c))}return u}function er(){return De(Re,(e,t)=>({日付:t,"病床利用率 (%)":.75+(Math.random()-.5)*.2,救急車搬入数:F(e,35,20,.7),入院患者数:A(200,30),退院予定数:F(e,25,10,.5),一般病棟在院数:A(180,25),集中治療室在院数:A(12,6),平均在院日数:14+(Math.random()-.5)*4,手術件数:F(e,25,15,.3),"長期入院者数（30日）":A(12,6)}))}const vr=P({type:"dummy",key:"dev-dashboard",displayName:"開発用ダッシュボード",generate:er,errorMessage:"開発用ダッシュボードデータの生成に失敗しました",polling:!1,devOnly:!0});function tr(){return De(Re,(e,t)=>({日付:t,reha_empty_beds:A(15,10),reha_bed_usage:.85+(Math.random()-.5)*.1,reha_performance_index:45+(Math.random()-.5)*10,reha_home_admission_rate:.6+(Math.random()-.5)*.1,reha_home_return_rate:.75+(Math.random()-.5)*.1,reha_ext_long_stay_patients:F(e,7,5,.7),reha_ext_bed_usage:.9+(Math.random()-.5)*.1}))}const Mr=P({type:"dummy",key:"dev-reha-dashboard",displayName:"開発用リハダッシュボード",generate:tr,errorMessage:"開発用リハダッシュボードデータの生成に失敗しました",polling:!1,devOnly:!0}),rr=[{id:"kyoritsu-001",slug:"kyoritsu",name:"戸畑共立病院",shortName:"共立",beds:218,type:"一般病院"},{id:"reha-001",slug:"reha",name:"戸畑リハビリテーション病院",shortName:"リハ",beds:120,type:"リハビリテーション病院"},{id:"ayame-001",slug:"ayame",name:"あやめの里",shortName:"あやめ",beds:80,type:"介護老人保健施設"},{id:"meiji-001",slug:"meiji",name:"明治町クリニック",shortName:"明治",beds:19,type:"診療所"}];function T(e,t){return Math.floor(Math.random()*(t-e+1))+e}function I(e,t,r=1){const s=Math.random()*(t-e)+e;return Number(s.toFixed(r))}function sr(e,t){const r=t==="一般病院"?85:t==="リハビリテーション病院"?90:75,s=I(r-10,r+5,1),n=Math.round(e*s/100),o=e-n,a=I(s-5,s+5,1),u=e/100,i=T(Math.floor(50*u),Math.floor(150*u)),c=n,l=T(Math.floor(5*u),Math.floor(15*u)),S=T(Math.floor(3*u),Math.floor(12*u)),b=I(12,25,1),D=T(Math.floor(e*2),Math.floor(e*3)),w=I(75,95,1),C=T(Math.floor(e*.3),Math.floor(e*.5)),x=T(Math.floor(e*.05),Math.floor(e*.1)),y=T(Math.floor(e*50),Math.floor(e*100)),k=T(Math.floor(y*.7),Math.floor(y*.9)),f=y-k,E=Number((f/y*100).toFixed(1));return{bedUtilization:s,usedBeds:n,availableBeds:o,occupancyRate:a,outpatients:i,inpatients:c,newAdmissions:l,discharges:S,avgStayDays:b,staffUtilization:w,totalStaff:D,nursesOnDuty:C,doctorsOnDuty:x,revenue:y,costs:k,profit:f,profitMargin:E}}function nr(e,t){const r=[],s=new Date,n=t==="一般病院"?85:t==="リハビリテーション病院"?90:75,o=e/100;for(let a=29;a>=0;a--){const u=new Date(s);u.setDate(u.getDate()-a);const i=he(u),c=u.getDay(),l=c===0||c===6?.7:1,S=I(-5,5,1),b=Number((n+S).toFixed(1)),D=Math.round(T(Math.floor(50*o),Math.floor(150*o))*l),w=Math.round(e*b/100);r.push({date:i,bedUtilization:b,outpatients:D,inpatients:w})}return r}function or(){return rr.map(e=>({id:e.id,slug:e.slug,name:e.name,shortName:e.shortName,beds:e.beds,type:e.type,kpis:sr(e.beds,e.type),trend:nr(e.beds,e.type)}))}const Ir=P({type:"dummy",key:"dev-total-metrics",displayName:"開発用全体指標",generate:or,errorMessage:"開発用全体指標データの生成に失敗しました",polling:!1,devOnly:!0});export{Vt as A,Gt as B,Er as G,_r as I,ot as J,Sr as P,at as W,Dr as a,Pr as b,fr as c,Ar as d,xr as e,br as f,vr as g,Mr as h,Ir as i,Rr as j,gr as k,pr as l,wr as m,Tr as n,rt as p,dr as r,mr as s,yr as t};
