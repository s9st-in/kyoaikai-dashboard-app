import"./DsnmJJEf.js";import{g as l,u as h,j as R,h as I,i as z,p as F,a as C,b as K,f as x,c as Y,r as D,t as w,d as N,s as W,k as lt}from"./p4dYvpg6.js";import{d as ot,s as O,a as dt}from"./T2Bmc5lN.js";import{s as ct}from"./BcvOLtEm.js";import{i as B}from"./36Dr0qmW.js";import{s as S,a as j}from"./Cq4yWqvx.js";import{p as _}from"./OQgd7Oh0.js";import{b as M}from"./vwVNdKjP.js";import{p as E,n as H}from"./CS60pbwF.js";import{l as b}from"./BhIsClV-.js";import{a as st}from"./CuRQ2e7u.js";import{c as ut,a as ft}from"./Bq9a2B43.js";import{_ as ht}from"./CLh3lXK5.js";import{C as gt}from"./BYYwbIbG.js";function U(a){const{themeColors:t,unit:e,decimalPlaces:n,labelCallback:r}=a,d=i=>{let o=i.dataset.label||"";return o&&(o+=": "),i.parsed.y!==null&&(o+=i.parsed.y.toFixed(n)+" "+e),o};return{mode:"index",intersect:!1,backgroundColor:t.tooltipBg,titleColor:t.text,bodyColor:t.text,footerColor:t.text,borderColor:t.tooltipBorder,borderWidth:1,padding:12,cornerRadius:8,displayColors:!0,boxWidth:12,boxHeight:12,boxPadding:6,usePointStyle:!0,callbacks:{label:r??d}}}function V(){return{padding:{top:10,right:10,bottom:5,left:5}}}function p(){return!1}function mt(a,t,e){return{legend:{display:!1},tooltip:U({themeColors:a,unit:t,decimalPlaces:e})}}function G(a,t,e){return{y:{beginAtZero:!0,max:e||void 0,border:{color:a.border,width:1,display:!0},grid:{color:a.grid,drawTicks:!0,tickLength:8,tickWidth:1,tickColor:a.grid,lineWidth:1},ticks:{color:a.text,padding:8,font:{size:11},callback:n=>n+" "+t},title:{display:!1}},x:{border:{color:a.border,width:1,display:!0},grid:{color:a.grid,drawTicks:!0,tickLength:8,tickWidth:1,tickColor:a.grid,lineWidth:1},ticks:{color:a.text,padding:8,font:{size:11},autoSkip:!0,maxTicksLimit:10,maxRotation:45,minRotation:45}}}}function Z(){return{mode:"nearest",axis:"x",intersect:!1}}function vt(a){const{themeColors:t,unit:e,maxY:n,decimalPlaces:r}=a;return{responsive:!0,maintainAspectRatio:!1,layout:V(),animation:p(),plugins:mt(t,e,r),scales:G(t,e,n),interaction:Z()}}function bt(a){const{themeColors:t,unit:e,maxY:n,decimalPlaces:r,stepSize:d}=a,i=G(t,e,n);return d&&i?.y?.ticks&&(i.y.ticks.stepSize=d),{responsive:!0,maintainAspectRatio:!1,layout:V(),animation:p(),plugins:{legend:{display:!1},tooltip:U({themeColors:t,unit:e,decimalPlaces:r})},scales:i,interaction:Z()}}function Ct(a){const{label:t,data:e,themeColors:n,stepped:r}=a;return{label:t,data:e,borderColor:n.line,backgroundColor:n.fill,borderWidth:2,tension:r?0:.1,fill:!0,pointRadius:3,pointHoverRadius:6,pointBackgroundColor:n.line,pointBorderColor:n.point,pointBorderWidth:1,pointHoverBackgroundColor:n.line,pointHoverBorderColor:n.pointHover,pointHoverBorderWidth:2,...r!==void 0&&{stepped:r}}}function xt(a){const{label:t,data:e,themeColors:n}=a;return{label:t,data:e,backgroundColor:n.line,borderColor:n.line,borderWidth:1,borderRadius:4}}function yt(a){return a.length>=90?!0:new Set(a.map(e=>e.日付&&E(e.日付)).filter(e=>e instanceof Date&&!Number.isNaN(e.getTime())).map(e=>e.getFullYear())).size>1}function _t(a,t,e){if(e){const n=H(e),r=a.findIndex(o=>o.日付&&H(o.日付)===n);if(r===-1)return a.slice(-t);let d=r-t+1,i=r+1;if(d<0){const o=-d;d=0,i=Math.min(r+1+o,a.length)}return a.slice(d,i)}return a.slice(-t)}function kt(a,t){return a.map(e=>{const n=e.日付;if(n){const r=E(n);return!r||Number.isNaN(r.getTime())?(b.warn(`Invalid date value: ${n}`),""):t?`${r.getFullYear()}/${r.getMonth()+1}/${r.getDate()}`:`${r.getMonth()+1}/${r.getDate()}`}return""})}function q(a){const t=h(()=>{const{data:d,period:i,date:o}=a();return!d||d.length===0?[]:_t(d,i,o)}),e=h(()=>yt(l(t))),n=h(()=>kt(l(t),l(e))),r=h(()=>{const{dataKey:d,transform:i}=a();return l(t).map(o=>{const g=d in o?o[d]:null,s=typeof g=="number"?g:null;return s==null?null:i?i(s):s})});return{get labels(){return l(n)},get values(){return l(r)}}}function J(a){const t=h(()=>st()),e=h(()=>{const{chartColors:r}=a();return ut(r,l(t))}),n=h(()=>{const{unit:r,maxY:d,decimalPlaces:i,optionsFactory:o}=a();return o?o(l(e)):vt({themeColors:l(e),unit:r,maxY:d,decimalPlaces:i})});return{get themeColors(){return l(e)},get options(){return l(n)},get currentMode(){return l(t)}}}function Q(a){let t=z(null),e=null,n;R(()=>{l(t)||ht(()=>import("./CquwA8NN.js"),[]).then(i=>{I(t,i.default,!0),b.debug("Chart.js loaded dynamically")}).catch(i=>{b.error("Failed to load Chart.js",i)})});function r(){const{id:i}=a();if(e)try{e.destroy()}catch(o){b.error(`Failed to destroy chart: ${i}`,o)}finally{e=null}}function d(i,o,g){const{canvas:s,id:m,chartType:k="line"}=a();if(!l(t)){b.debug(`Chart.js not loaded yet for chart: ${m}`);return}if(!s){b.debug(`Canvas not ready for chart: ${m}`);return}if(s!==n&&(r(),n=s),i.length===0){b.warn(`No data for chart: ${m}`),r();return}const P=s.getContext("2d");if(!P){b.error(`Failed to get 2D context for chart: ${m}`);return}if(!e){e=new(l(t))(P,{type:k,data:{labels:i,datasets:[o]},options:g}),b.debug(`Chart rendered: ${m}`);return}e.data.labels=i,e.data.datasets[0]=o,e.options=g,e.update(),b.debug(`Chart updated: ${m}`)}return R(()=>()=>{e&&r()}),{renderOrUpdate:d}}var Pt=x('<div class="flex h-full items-center justify-center"><p class="text-tertiary text-sm">データがありません</p></div>'),Yt=x('<canvas class="h-full w-full"></canvas>'),Dt=x('<div class="relative h-full w-full"><!></div>');function Tt(a,t){F(t,!0);let e=_(t,"date",3,null),n=_(t,"decimalPlaces",3,1),r=z(void 0);const d=q(()=>({data:t.data,dataKey:t.dataKey,period:t.period,date:e(),transform:t.transform})),i=J(()=>({chartColors:t.chartColors,unit:t.unit,maxY:t.maxY,decimalPlaces:n()})),o=Q(()=>({canvas:l(r),id:t.id})),g=h(()=>l(r)!==void 0&&t.data!==null&&t.data.length>0&&t.period>0);R(()=>{if(l(g)){const c=Ct({label:t.title,data:d.values,themeColors:i.themeColors,stepped:t.stepped});o.renderOrUpdate(d.labels,c,i.options)}});var s=Dt(),m=Y(s);{var k=c=>{var f=Pt();C(c,f)},P=c=>{var f=Yt();M(f,T=>I(r,T),()=>l(r)),w(()=>S(f,"id",t.id)),C(c,f)};B(m,c=>{!t.data||t.data.length===0?c(k):c(P,!1)})}D(s),C(a,s),K()}var wt=x('<div class="flex h-full items-center justify-center"><p class="text-tertiary text-sm">データがありません</p></div>'),Bt=x('<canvas class="h-full w-full"></canvas>'),Lt=x('<div class="relative h-full w-full"><!></div>');function Rt(a,t){F(t,!0);let e=_(t,"date",3,null),n=_(t,"decimalPlaces",3,1),r=z(void 0);const d=q(()=>({data:t.data,dataKey:t.dataKey,period:t.period,date:e(),transform:t.transform})),i=J(()=>({chartColors:t.chartColors,unit:t.unit,maxY:t.maxY,decimalPlaces:n(),optionsFactory:c=>bt({themeColors:c,unit:t.unit,maxY:t.maxY,decimalPlaces:n(),stepSize:t.stepSize})})),o=Q(()=>({canvas:l(r),id:t.id,chartType:"bar"})),g=h(()=>l(r)!==void 0&&t.data!==null&&t.data.length>0&&t.period>0);R(()=>{if(l(g)){const c=xt({label:t.title,data:d.values,themeColors:i.themeColors});o.renderOrUpdate(d.labels,c,i.options)}});var s=Lt(),m=Y(s);{var k=c=>{var f=wt();C(c,f)},P=c=>{var f=Bt();M(f,T=>I(r,T),()=>l(r)),w(()=>S(f,"id",t.id)),C(c,f)};B(m,c=>{!t.data||t.data.length===0?c(k):c(P,!1)})}D(s),C(a,s),K()}var St=x('<div class="mb-2 flex items-center justify-between"><h3> </h3> <button type="button" class="text-secondary hover:text-primary transition-colors"><span class="material-symbols-outlined text-[20px]" aria-hidden="true">close</span></button></div>'),Wt=x("<h3> </h3>"),It=x('<!> <div class="min-h-0 flex-1"><!></div> <!>',1);function Zt(a,t){F(t,!0);const e=ft("rgb(107, 114, 128)","rgb(156, 163, 175)");let n=_(t,"class",3,"h-[420px] md:min-h-[560px] p-4"),r=_(t,"compact",3,!1),d=_(t,"idSuffix",3,""),i=_(t,"variant",3,"default");const o=h(()=>r()?"text-base md:text-lg mb-2":"text-xl mb-3"),g=h(()=>t.graph.chartColors??e),s=h(()=>`${t.graph.id}${d()}`),m=h(()=>i()==="dev"?t.badgeText??"DEV":void 0);gt(a,{get variant(){return i()},get badge(){return l(m)},get devInfo(){return t.devInfo},get devContent(){return t.devContent},get class(){return`flex flex-col ${n()??""}`},children:(k,P)=>{var c=It(),f=N(c);{var T=u=>{var v=St(),y=Y(v),nt=Y(y,!0);D(y);var A=W(y,2);D(v),w(()=>{j(y,1,`text-primary font-bold tracking-wide ${l(o)??""}`),O(nt,t.graph.title),S(A,"aria-label",`${t.graph.title??""}を削除`)}),dt("click",A,function(...it){t.onClose?.apply(this,it)}),C(u,v)},X=u=>{var v=Wt(),y=Y(v,!0);D(v),w(()=>{j(v,1,`text-primary text-center font-bold tracking-wide ${l(o)??""}`),O(y,t.graph.title)}),C(u,v)};B(f,u=>{t.onClose?u(T):u(X,!1)})}var L=W(f,2),$=Y(L);{var tt=u=>{Rt(u,{get id(){return l(s)},get title(){return t.graph.title},get dataKey(){return t.graph.dataKey},get chartColors(){return l(g)},get unit(){return t.graph.unit},get maxY(){return t.graph.maxY},get transform(){return t.graph.transform},get data(){return t.data},get period(){return t.period},get date(){return t.date},get decimalPlaces(){return t.graph.decimalPlaces},get stepSize(){return t.graph.stepSize}})},et=u=>{Tt(u,{get id(){return l(s)},get title(){return t.graph.title},get dataKey(){return t.graph.dataKey},get chartColors(){return l(g)},get unit(){return t.graph.unit},get maxY(){return t.graph.maxY},get transform(){return t.graph.transform},get data(){return t.data},get period(){return t.period},get date(){return t.date},get decimalPlaces(){return t.graph.decimalPlaces}})};B($,u=>{t.graph.chartType==="bar"?u(tt):u(et,!1)})}D(L);var at=W(L,2);{var rt=u=>{var v=lt(),y=N(v);ct(y,()=>t.children),C(u,v)};B(at,u=>{t.children&&u(rt)})}w(()=>S(L,"aria-label",t.graph.title)),C(k,c)},$$slots:{default:!0}}),K()}ot(["click"]);export{Rt as B,Tt as L,Zt as W,p as c,Q as u};
