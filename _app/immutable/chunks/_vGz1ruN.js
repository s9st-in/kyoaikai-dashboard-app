import{M as d,S,x as u,g as t,u as P,T as v}from"./Dj_qSXc_.js";import{l as i,g as T}from"./CyAkH-4i.js";function h(e){return e()}function M(e){return h(()=>localStorage.getItem(e))??null}function R(e,n){h(()=>localStorage.setItem(e,n))}function Q(e){h(()=>localStorage.removeItem(e))}const p=["light","dark"];function C(e){return typeof e=="string"&&p.includes(e)}let r=d(S(new Map)),m=d("light"),s=d(null);const g=P(()=>t(s)?t(r).get(t(s))??t(m):t(m)),w=S(new Set);let o=d(0),l=null;function f(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function c(){document.documentElement.setAttribute("data-mode",t(g));const e=t(s)?t(r).get(t(s)):null;i.debug(`[Theme] 適用: ${t(g)} (ルート: ${t(s)??"none"}, 設定: ${e??"system"})`)}function b(e){const n=T(e),a=M(n);u(r,new Map(t(r)),!0),C(a)?(t(r).set(e,a),i.debug(`[Theme] 設定を復元: ${a} (ルート: ${e})`)):t(r).set(e,null)}function E(e){const n=t(r).get(e);if(n){const a=T(e);R(a,n),i.debug(`[Theme] 設定を保存: ${n} (ルート: ${e})`)}}function U(e){u(s,e,!0);const n=t(o);if(v(o),w.has(e)?(i.debug(`[Theme] 既に初期化済み (ルート: ${e})`),c()):(b(e),w.add(e)),n===0&&t(o)===1){u(m,f(),!0);const a=window.matchMedia("(prefers-color-scheme: dark)"),$=()=>{u(m,f(),!0),c(),i.debug("[Theme] システムテーマ変更検知")};a.addEventListener("change",$),l=()=>{a.removeEventListener("change",$)},i.debug("[Theme] mediaQueryリスナーを登録")}return c(),i.info(`[Theme] 初期化完了 (ルート: ${e}, 設定: ${t(r).get(e)??"system"}, 適用: ${t(g)}, activeCount: ${t(o)})`),()=>{v(o,-1),t(o)<0&&(i.warn("[Theme] activeRouteCountが負になりました。0にリセットします。"),u(o,0)),t(o)===0&&l&&(l(),l=null,i.debug("[Theme] mediaQueryリスナーを削除")),i.debug(`[Theme] クリーンアップ (ルート: ${e}, activeCount: ${t(o)})`)}}function I(){if(!t(s)){i.warn("[Theme] ルートタイプが設定されていないため、テーマを切り替えられません");return}const e=t(r).get(t(s));let n;e?n=e==="light"?"dark":"light":n=f()==="light"?"dark":"light",u(r,new Map(t(r)),!0),t(r).set(t(s),n),E(t(s)),i.debug(`[Theme] 切り替え: ${t(r).get(t(s))} (ルート: ${t(s)})`),c()}function _(e){const n=e??t(s);return n?t(r).get(n)??null:null}function x(){return t(g)}function A(e,n){const a=n==="system"?null:n;u(r,new Map(t(r)),!0),t(r).set(e,a),E(e),i.debug(`[Theme] 外部設定更新: ${n} → ${a} (ルート: ${e})`),t(s)===e&&c()}function K(e,n){const a=n==="system"?null:n;u(r,new Map(t(r)),!0),t(r).set(e,a),i.debug(`[Theme] プレビュー: ${n} → ${a} (ルート: ${e})`),t(s)===e&&c()}function F(e){b(e),i.debug(`[Theme] 保存済みに復元 (ルート: ${e})`),t(s)===e&&c()}export{F as a,A as b,x as c,_ as d,M as g,U as i,K as p,Q as r,R as s,I as t};
